\chapter{Hybrid Programs with DDEs}\label{hybrid-programs-with-ddes}

We extent hybrid programs (\HPs) and formulae of classical \dL with syntax, semantics, axiomatization and proof rules which allow to deal with Delay Differential Equations.
%Is a super set, \dL is a fragment
Call obtained \dHPs and \ddL.

Similiar to first-order logic and essentially as an extension of dL we define delay differential logic

\cite{Platzer12Complete,Platzer15Uniform}

\section{Example}
    \label{example-hp-cars}
    To motivate the need of being able to treat Delayed Differential Equations in hybrid programs, we present some examples.

    \subsection{Leading and Following Car}

    \subsection{Network Induced Delay in Control Loops}

\section{Syntax}
    \label{sec:syntax}

    The syntax of \ddL terms, formulae as well as of \dHPs is defined inductively by a grammar in Backus-Naur-form (BNF).

    Let $\allvars$ be the set of \emph{all variables} and $\diffvars\defeq\{\D{x} \with x\in\allvars\}$ the corresponding set of \emph{differential symbols}.
    Let $\constants$ be the set of \emph{all constants}. We denote $\delayvars\defeq\{\xtau[c] \with x\in\allvars, c\in\constants\}$ the set of \emph{delayed variables} and $\delaydiffvars\defeq\{\Dxtau[c] \with \D{x}\in\diffvars, c\in\constants\}$ the set of \emph{delayed differentials}.

    We will usually denote variables by $x,y,z\in\allvars$ and their differential symbols by $\D{x},\D{y},\D{z}\in\diffvars$.

    \emph{Function symbols} $f,g,h$, \emph{constant symbols} $a,b,c$ and \emph{predicate symbols} $p,q,r$ are as in first-order logic (cf.\ Section~\ref{sec:first-order-logic}).

    We use $\astrm,\bstrm$ for \ddL terms, $\asfml,\bsfml$ for \ddL formulae, $\asprg,\bsprg$ for \dHPs and $\asfmlfolR,\bsfmlfolR$ for formulae of first-order logic of real arithmetic.

    % FIXME: what are program constants?
    %program constants $ $, may be in $\rationals$
extending \dL with symbols for \emph{delayed variables} and \emph{differentials}
    \begin{definition}[Terms]\label{def:syntax-terms}
        The syntax of \emph{terms} of \emph{delay differential dynamic logic} is defined by the following grammar:
        \begin{equation*}
            \astrm,\bstrm \Coloneqq
                \xtau[s] \mid
                \Dxtau[s] \mid
                % TODO: maybe dont need x[c], only with s and use t(s) with specified s, as in DDE and extra x[0]=x
                \xtau[b] \mid
                \Dxtau[b] \mid
                c \mid
                f(\range{\istrm{1}}{\istrm{k}}) \mid
                \astrm + \bstrm \mid
                \astrm \cdot \bstrm \mid
                % FIXME: is term' allowed? diff inv is only a FOLR formula? even for dL valid?
                \D{(\astrm)}
        \end{equation*}
        % TODO: line breaks and explination text in syntax
        % \begin{align}
        %     \astrm\Coloneqq{}&\\
        %     &\mid \astrm+\bstrm\hfill\text{test}
        % \end{align}
        where $x\in\allvars,\D{x}\in\diffvars$ and $f$ is a function symbol of arity $k$.
        The symbol $c\in\constants$ defines a rational number constant and $b\in\Q_{\leq 0}$.
        All terms implicitely depend on a time parameter $s\in\R_{\leq 0}$, written as $\astrm(s)$. When $s=0$ we abbreviate the notation to $\astrm$.
        The variable symbol $x$ and the differential symbol $\D{x}$ are the only ones which allow explicitely mentioning this parameter. They are spelled slightly differently using square brackets as $\xtau[s]$ and $\Dxtau[s]$, respectively. Note that $s\notin\allvars\cup\diffvars\cup\constants$. It is a special variable.
        In particular, for $\xtau[0]$ we write $x$ and $\D{x}$ for $\Dxtau[0]$.

        Writing $\astrm(-\tau)$ means that all occurences of $s$ in $\astrm$ have been replaced with $-\tau$.
        parameter is inherited

        % TODO: subtraction and division in terms

        %The symbol $x$ is only allowed in the right hand side of a DDE and in evolution domain constraints, not in other formulas. The latter may only contain $\xtau$.
    \end{definition}

    \begin{example}
        Let us consider the \ddL term
        \begin{equation}
            \astrm(s) = \underbrace{\xtau[s]}_{\text{var}} + \underbrace{\xtau}_{\text{const}}.
        \end{equation}
        Setting $s=-1$ gives the term
        \begin{equation}
            \astrm(-1) = \xtau[-1] + \xtau.
        \end{equation}
    \end{example}

    The grammar defining \emph{delayed hybrid programs} is the same as for classical \HPs (cf. \cite{Platzer15Uniform}) and is shown here for completeness.

    \begin{definition}[(Delay) Hybrid Programs]\label{def:syntax-HP}
        The syntax of\emph{(delay) hybrid programs} (\dHPs) is defined by
        % TODO: first-order logic of real arithmetic formulas include \xtau?
        \begin{equation*}
            \asprg, \bsprg \Coloneqq
                % program constants?
                %a \mid
                % FIXME: do I need theta(0), or can I later just say, s not free in theta ?
                \hupdate{\humod{x}{\astrm(0)}} \mid
                \Dupdate{\Dumod{\D{x}}{\astrm(0)}} \mid
                \htest{\asfmlfolR} \mid
                \hchoice{\asprg}{\bsprg} \mid
                % TODO: replace ; in HPs
                \asprg;\bsprg \mid
                \hrepeat{\asprg} \mid
                \hevolvein{\D{x}=\astrm(0)}{\ivr}
        \end{equation*}
        % TODO: ddes with mult const delay
        % TODO: program constant
        where $\asprg, \bsprg$ denote \dHPs, with a variable $x$, a term $\astrm$ (possibly containing $x$ or $\xtau$) and $\ausprg$ a program constant.
        The formula $\asfmlfolR$ is of first-order logic of real arithmetic \FOLR$(\allvars)$, containing only normal variable symbols $\allvars$.
        Note that $s\notin\asprg$ and that the syntax only allows autonomous DDEs.
    \end{definition}

    The difference between classical \HPs (in the sense of ...) and \dHPs is not syntactically, but only given by their semantics.

    refer to Section \ref{sec:dynamic-semantics} for meaning of the following, different meaning for formulae

    assignment, discretely at an instant of time
    test of formula in current state
    nondeterministic choice
    sequential composition
    nondeterministic repetition
    delay differential equation with restricted evolution, due to domain constraint $\bsfml$, follow arbitrary amount of time
    DDE with delay tau, term has only $x$ and $\D{x}$ with constant nor var $s$
    ODE still possible


    \begin{definition}[\ddL Formulas]\label{def:syntax-formula}
        The the syntax for \emph{formulae} of \emph{delay differential dynamic logic} is defined by
        \begin{align*}
            \asfml,\bsfml \Coloneqq{}& % fixes missing space
                % TODO: better abbreviated notation for \holdssince, make forall only appear in semantics rhs
                \astrm\geq\bstrm \mid
                p(\range{\istrm{1}}{\istrm{k}}) \mid
                %\contextapp{C}{\asfml} \mid
                \lnot\asfml \mid
                \asfml\land\bsfml \mid\\
                &\holdssince{T}{\asfml(s)} \mid
                \lforall{x}{\asfml} \mid
                \lexists{x}{\asfml} \mid
                \dbox{\asprg}{\asfml} \mid
                \ddiamond{\asprg}{\asfml}
        \end{align*}
        with \ddL terms $\astrm,\bstrm,\range{\istrm{1}}{\istrm{k}}$,
        a predicate symbol $p$, a quantifier symbol $C$, a variable $x$, and a \dHP $\asprg$.
        
        % TODO: need = in formulas ?
        Other operators
        $\sim$ for $=,<,\leq,>,\geq$, such as $\lor,\limply,\lbisubjunct$ can be derived from $\land,\lnot$ and are hence not explicitely mentioned in the grammar.

        modal formula $\dbox{\asprg}{\asfml}$ : $\asfml$ holds in the state after all runs of $\asprg$, dual: there is a run
        % TODO: what is a quantifier symbol? (-> US paper)
        % quantifier symbols $C$, with formula as argument are higher order predicate symbols and bind the variables of $\asfml$

        The quantifiers $\forall$ and $\exists$ quantify over $\statespace$.

        The symbol $T$ is a symbolic constant related to the history duration induced by the occurence of a delay-differnetial equation. Its value is set by proof rules.
    \end{definition}

    % TODO: FOLR is subset of ddL formulae
    \FOLR formulae are a subset of \ddL.

    When terms do not depend on quantified parameter, can omit writing down forall in formula

    \begin{convention}
        The frequently appearing fact that $\asfml(s)$ not only holds for $s\in\delayinterval$ but also in $s=0$
        \begin{equation*}
            \holdssince{T}{\asfml(s)}\land\asfml(0)
        \end{equation*}
        can also be written as
        \begin{equation*}
            \holdssinceclosed{T}{\asfml(s)}
        \end{equation*}
        For convenience, we allow the latter, abbreviated notation, which is implicitely replaced by the former, syntactically correct version.
    \end{convention}

\section{Dynamic Semantics}
    \label{sec:dynamic-semantics}

    % TODO: state space pw diffable
    Following the remark to the solution of a DDE (cf. Section \ref{sec:definition-of-solution}), we define the \emph{state space} in \ddL to $\statespace$, the set of piecewise continuously differentiable functions on $\closeddelayinterval$, as defined in Definition~\ref{def:piecewise-continuous}.

    This means that a variable remembers a limited part of its evolution history, what demands hence an implicit notion of a underlying time.

    We denote by $\states$ the \emph{set of states}. A \emph{state} $\asstate\in\states$ is a mapping
    \begin{equation}
        \asstate \from \allvars\cup\diffvars \to \statespace
    \end{equation}
    which assigns a \emph{history} (function) to each variable and differential symbol.

    By $\modif{\asstate}{x}{r}$ we denote the state which is equal to state $\asstate$, except for the value of the variable $x$ which is set to $r\in\statespace$.

    % FIXME: modification of x in state and general specification of pw function associated to x
    %at the time $t=0$. The value of $x$ for the time before does not change.

    % TODO: Abgrenzung zu Trace Semantics
    % The temporal character of delay differential equations (they depend on their own temporal evolution with limited horizon) suggests the introduction of trace semantics.
    %
    % However, we go the way of introducing transition semantics with an augmented state space.

    \begin{definition}[Semantics of terms]\label{def:sematic-terms}
        The \emph{semantics} of a term $\astrm$ in the state $\asstate\in\states$ (at time instant $t$) is a value in $\R$ and defined inductively as follows:
        \begin{enumerate}
            \item $\ivaluation{\IddL}{\xtau[s]} = \asstate(x)(s)$ for a variable $x\in\allvars$
            % FIXME: need Cpw for derivatives or only \R?
            \item $\ivaluation{\IddL}{\Dxtau[s]} = \asstate(\D{x})(s)$ for a differential symbol $\D{x}\in\diffvars$
            \item $\ivaluation{\IddL}{\xtau[b]} = \asstate(x)(b)$ for a variable $x\in\allvars$ and a constant $b\in\constants$ with $\interpret[b]\in\Q_{\leq 0}$
            \item $\ivaluation{\IddL}{\Dxtau[b]} = \asstate(\D{x})(b)$ for a differential symbol $\D{x}\in\diffvars$ and a constant $b\in\constants$ with $\interpret[b]\in\Q_{\leq 0}$
            \item $\ivaluation{\IddL}{\Dxtau[b]} = \lim_{s\downto \interpret[b]} \frac{\asstate(x)(s)-\asstate(x)(\interpret[b])}{s-\interpret[b]}$
            \item $\ivaluation{\IddL}{c} = \interpret[c]$ for a constant $c\in\constants$
            \item $\ivaluation{\IddL}{f(\range{\istrm{1}}{\istrm{k}})} = \interpret[f](\range{\ivaluation{\IddL}{\istrm{1}}}{\ivaluation{\IddL}{\istrm{k}}})$ for a function symbol $f$
            \item $\ivaluation{\IddL}{\astrm+\bstrm} = \ivaluation{\IddL}{\astrm} + \ivaluation{\IddL}{\bstrm}$
            \item $\ivaluation{\IddL}{\astrm\cdot\bstrm} = \ivaluation{\IddL}{\astrm} \cdot \ivaluation{\IddL}{\bstrm}$
            % FIXME: derivation of terms with x'?
            \item $\ivaluation{\IddL}{\D{(\astrm)}} = \displaystyle\sum_{\xtau[c]\in\delayvarswiths} \asstate(\D{x})(\interpret[c])\frac{\partial\ivaluation{\IddL}{\astrm}}{\partial \xtau[c]}$
        \end{enumerate}
        %where $s\in [-T,0]$.
        The  syntactic (total) derivation, defined in \ref{def:derivation}, gives new term
    \end{definition}
        % TODO: mention 'interpretation' for semantics.
        % FIXME: interpretation of $f$ is a smooth function


    % TODO: total derivative operator for terms
    \begin{definition}[Derivation]\label{def:derivation}
        common derivation rules
        $\D{(\xtau[b])}=\Dxtau[b]$ need in premise $\D{x}$ on $[t+b,t]$
    \end{definition}

    % The semantic of the new symbol $\xtau$ depends on the context in which the term occures:
    % \begin{enumerate}
    %     \item in a hybrid program: $\imodel{\IddL}{\xtau} = \imodel{\IddL}{x(t-\tau)} = \nu(x)(-\tau)\in\R$
    %     \item in a formula $\xtau\in\statespace$: \begin{equation}
    %         % FIXME: rechte seite noch nicht korrekt
    %         \imodel[]{}{\phi(\xtau)} =
    %         \{\nu\in\states : \lforall{t\in[-\tau,0]}{\phi(\nu(x)(t))} \}
    %     \end{equation}
    %     with uniform substitution: $\sigma=\{\xtau\rightarrow\theta_0\}$
    % \end{enumerate}

    The meaning of a differential symbol: defined by state, 
    The time derivative of a variable may not be defined in isolated state, because it might have a discontinuity here and we cannot use its history (provided by the state) to define derivative.
    However, we can define a state local semantics for a differential $\D{(\astrm)}$.

    Like for ODE case, only use last value given in state. Since in $t=0$ could be incontinuity 

    chain rule for $\astrm(s)$
    $\asfml$ only mentions finitely many variables, finite sum
    $\ivaluation{\IddL}{\D{(\astrm)}}(s)$ is smooth as composition of smooth functions, derivatives exist

    Along a solution of a DDE $\varphi:[0,r]\rightarrow\states$ (continous differentiable), the differential symbols are interpreted as time derivatives, $r>0$ at any $\zeta\in[0,r]$, meaning of symbol is rate of change of value of $x$ over time
    \begin{equation}
        % TODO: replace \DD with Andres command
        \imodel{\IddL}{\D{x}}\varphi(\zeta)
            = \varphi(\zeta)(\D{x})(0)
            \defeq \DD{\varphi(t)(x)(0)}{t}(\zeta)
            = \DD{\imodel{\IddL}{x}\varphi(t)}{t}(\zeta)
    \end{equation}
    if $r=0$
    and what if there is no ODE/DDE given: in a given state should also be real value
    
    in initial state an arbitray value is allowed, will then sync with equation to fullfil $\varphi(\zeta)(\D{x})=\imodel{\IddL}{f(x)}\varphi(r)$
    initial value $\asstate(\D{x})$ may not be compatible with derivative
    final values coincide

    In the precondition, no values are associated to the differential symbols. In general, the initial function is only piecewise continuous.
    Since for later time instances, the values of the differential symbols derive from the DDE, they become (locally) smooth function.

    \begin{definition}[Semantics of \ddL formulae]\label{def:semantic-formulae}
        The semantics of a \ddL formula $\asfml$ is the subset of all states $\imodel{\IddL}{\asfml}\subseteq\states$ in which $\asfml$ is true. This set is given inductively by
        % TODO: mention interpretation I
        % FIXME: what is difference between \imodel and \ivaluation?
        % terms: ivaluation, formula: imodel, programms: ireachability
        \begin{enumerate}
            % TODO: replace : in set by \with
            % FIXME: change ':' in sets to '|'
            % FIXME: use notation forall ... : ...
            % FIXME: *version for lforall without parentheses
            %\item $\imodel{\IddL}{\holdssince{T}{\astrm\geq\bstrm}} = \left\{\asstate\in\states \with \holdssince{T}{\ivaluation{\IddL}{\astrm(s)}\geq\ivaluation{\IddL}{\bstrm(s)}}\right\}$
            %\item $\imodel{\IddL}{\holdssince{T}{p(\range{\istrm{1}}{\istrm{k}})}} = \left\{\asstate\in\states \with \holdssince{T}{\left(\range{\imodel{\IddL}{\istrm{1}(s)}}{\imodel{\IddL}{\istrm{k}(s)}}\right)\in\interpret[p]}\right\}$
            \item $\imodel{\IddL}{\astrm(s)\geq\bstrm(s)} = \left\{\asstate\in\states \with \ivaluation{\IddL}{\astrm(s)}\geq\ivaluation{\IddL}{\bstrm(s)}\right\}$
            \item $\imodel{\IddL}{p(\range{\istrm{1}(s)}{\istrm{k}(s)})} = \left\{\asstate\in\states \with \left(\range{\ivaluation{\IddL}{\istrm{1}(s)}}{\ivaluation{\IddL}{\istrm{k}(s)}}\right)\in\interpret[p]\right\}$
            \item $\imodel{\IddL}{\contextapp{C}{\asfml}} = \interpret[C]\left(\imodel{\IddL}{\asfml}\right)$ for a quantifier symbol $C$
            \item $\imodel{\IddL}{\lnot\asfml} = \scomplement{\left(\imodel{\IddL}{\asfml}\right)} = \states\setminus\imodel{\IddL}{\asfml}$
            \item $\imodel{\IddL}{\asfml\land\bsfml} = \imodel{\IddL}{\asfml}\cap\imodel{\IddL}{\bsfml}$
            \item $\imodel{\IddL}{\holdssince{T}{\asfml(s)}} = \left\{\asstate\in\states \with \holdssince{T}{\asstate\in\imodel{\IddL}{\asfml(s)}} \right\}$
            \item $\imodel{\IddL}{\lforall{x}{\asfml}} = \{\asstate\in\states \with \modif{\asstate}{x}{y}\in\imodel{\IddL}{\asfml} \text{ for all } y\in\statespace \}$
            \item $\imodel{\IddL}{\lexists{x}{\asfml}} = \{\asstate\in\states \with \modif{\asstate}{x}{y}\in\imodel{\IddL}{\asfml} \text{ for some } y\in\statespace \}$
            \item $\imodel{\IddL}{\dbox{\asprg}{\asfml}} = \{\asstate\in\states \with \bsstate\in\imodel{\IddL}{\asfml} \text{ for all $\bsstate$ such that} (\asstate,\bsstate)\in\ireachability{\IddL}{\asprg}\}$, i.e. $\{\asstate\in\states \with \mforall{\bsstate\in\states}\holds((\asstate,\bsstate)\in\ireachability{\IddL}{\asprg} \limply \bsstate\in\imodel{\IddL}{\asfml})\}$
            \item $\imodel{\IddL}{\ddiamond{\asprg}{\asfml}} = \{\asstate\in\states \with \bsstate\in\imodel{\IddL}{\asfml} \text{ for some $\bsstate$ such that} (\asstate,\bsstate)\in\ireachability{\IddL}{\asprg}\}$, i.e. $\{\asstate\in\states \with \mexists{\bsstate\in\states}\holds((\asstate,\bsstate)\in\ireachability{\IddL}{\asprg} \land \bsstate\in\imodel{\IddL}{\asfml})\}$
        \end{enumerate}
        The fact that formula $\asfml$ is true in state $\asstate$ under the interpretation $\interpret$, i.e. $\asstate\in\imodel{\IddL}{\asfml}$ can also be written as $\imodels{\IddL}{\asfml}$.
        A formula $\asfml$ is called valid, written as $\models\asfml$, if and only if $\asfml$ is true in all states under all interpretations.
    \end{definition}

    interpretation of predicate symbol, arity n: relation $I(p)\subseteq\R^n$
    %interpretation of a quantifier symbol: functional $I(C):M\subseteq\states\to P(\states)$ maps subsets of states to subsets of states

    Atomic formulas (type 1 and 2) need to be combined with the quantification over s (6) in order to make sense. See Section \ref{sec:well-definedness}.

    With the semantics of terms if follows for the meaning of $\dbox{\asprg}{\phi}$, that $\phi$ must only hold up to time $\tau$ before leaving the \HP $\asprg$. It is possible, that $\phi$ was not verified before, while \emph{executing} the \HP.

    However when we apply the Rule of steps, we get the validity of $\phi$ for the entire trace.

    % TODO: is it better to only have xtau and not choice? What if both mentioned?
    in formulae (such as safety condition or evolution constraint), we have two possibilities: only value at current time instant ($x$) or for entire last $\tau$ time $\xtau$

    $\dbox{}{}$ and $\ddiamond{}{}$ only refer to last state and not intermediate states, as \dTL does.


    

    % TODO: Move to static semantics
    If no dependence on $s$ in terms, $\holdssince{T}{}$ can be dropped in formula.

    \begin{example}
        Consider the two well-formed \ddL formulae:
        \begin{align*}
            &\holdssince{T}{x+\xtau[s]\geq 0}\\
            &\holdssince{T}{x+\xtau\geq 0} 
        \end{align*}
        The quantification over $s$ in the second formula can be dropped.
    \end{example}

    % TODO: do we accept that or restrict formula after modality to not having $s$ free? then, since s\notin\asprg commutes also for diamond
    \begin{lemma}[Barcan formula]
        The box modality and the quantification over $s$ commute
        \begin{equation*}
            \imodel{\IddL}{\holdssince{T}{\dbox{\asprg}{\asfml(s)}}} = \imodel{\IddL}{\dbox{\asprg}{(\holdssince{T}{\asfml(s)})}}
        \end{equation*}
    \end{lemma}
    \begin{proof}
        Since $\mforall{x}\holds(p\mimply q(x))\equiv p\mimply\mforall{x}\holds q(x)$, it holds
        \begin{multline*}
            % FIXME: use \set instead of {}
            % FIXME: proper use of lforall and mforall
            \imodel{\IddL}{\holdssince{T}{\dbox{\asprg}{\asfml(s)}}} =\\
            \begin{split}
                &= \set{\asstate\in\states \with \holdssince{T}{\mforall{\bsstate\in\states}\holds (\asstate,\bsstate)\in\ireachability{\IddL}{\asprg} \mimply \bsstate\in\imodel{\IddL}{\asfml(s)}}}\\
                &= \set{\asstate\in\states \with \mforall{\bsstate\in\states}{\holdssince{T}{(\asstate,\bsstate)\in\ireachability{\IddL}{\asprg} \mimply \bsstate\in\imodel{\IddL}{\asfml(s)}}}}\\
                &= \set{\asstate\in\states \with \mforall{\bsstate\in\states}{(\asstate,\bsstate)\in\ireachability{\IddL}{\asprg} \mimply \holdssince{T}{\bsstate\in\imodel{\IddL}{\asfml(s)}}}}\\
                &= \set{\asstate\in\states \with \mforall{\bsstate\in\states}{(\asstate,\bsstate)\in\ireachability{\IddL}{\asprg} \mimply \bsstate\in\imodel{\IddL}{\holdssince{T}{\asfml(s)}}}}\\
                &= \imodel{\IddL}{\dbox{\asprg}{(\holdssince{T}{\asfml(s)})}}
            \end{split}
        \end{multline*}
    \end{proof}
    
    However, the diamond modality does not commute with the s-quantification.
    % TODO: counterexample for not commuting diamond and forall-s
    \begin{equation}
        \imodel{\IddL}{\holdssince{T}{\ddiamond{\asprg}{\asfml(s)}}} \neq \imodel{\IddL}{\ddiamond{\asprg}{(\holdssince{T}{\asfml(s)})}}
    \end{equation}

    Since, with respect to \dL, the state space has been replaced, we need to redefine the semantics.
    
    \begin{definition}[Transition semantics of \HPs]\label{def:semantic-HP}
        The interpretation of a \HP is given by a binary \emph{reachability relation} $\ireachability{\IddL}{\asprg}\subseteq\states\times\states$ between states:
        \begin{enumerate}
            \item $\ireachability{\IddL}{a} = \interpret[a]$ for a program constant $a$
            \item\label{itm:sem-HP-assgn} $\ireachability{\IddL}{\hupdate{\humod{x}{\astrm}}} =
                \left\{(\asstate,\bsstate)\with \bsstate = \asstate \text{ except }
                \bsstate(x) = \left(s\mapsto\begin{cases}
                    \ivaluation{\IddL}{\theta(s)} & s=0\\
                    \asstate(x)(s) & s\in[-T,0)
                \end{cases}\right)\right\}$
            \item $\ireachability{\IddL}{\Dupdate{\Dumod{\D{x}}{\astrm}}} =
                \left\{(\asstate,\bsstate)\with \bsstate = \asstate \text{ except }
                \bsstate(\D{x}) = \left(s\mapsto\begin{cases}
                    \ivaluation{\IddL}{\theta(s)} & s=0\\
                    \asstate(x)(s) & s\in[-T,0)
                \end{cases}\right)\right\}$
            \item $\ireachability{\IddL}{\htest{\asfmlfolR}} = \left\{(\asstate,\asstate) \with \asstate\in\imodel{\IddL}{\asfmlfolR} \right\}$
            \item $\ireachability{\IddL}{\hchoice{\asprg}{\bsprg}} = \hchoice{\ireachability{\IddL}{\asprg}}{\ireachability{\IddL}{\bsprg}}$
            \item $\ireachability{\IddL}{\asprg;\bsprg} = \left\{ (\asstate,\bsstate) \with (\asstate,\csstate)\in\ireachability{\IddL}{\asprg}, (\csstate,\bsstate)\in\ireachability{\IddL}{\bsprg} \right\}$
            \item $\ireachability{\IddL}{\hrepeat{\asprg}} %= \hrepeat{(\ireachability{\IddL}{\asprg})}
                = \displaystyle\cupfold_{n\in\N}\ireachability{\IddL}{\asprg^n}$ with $\asprg^{n+1}\equiv (\asprg^n;\asprg)$ and $\asprg^0\equiv \htest{\ltrue}$
            \item\label{itm:sem-HP-DDE} $\ireachability{\IddL}{\hevolvein{\D{x}=\astrm(-\tau)}{\ivr}} = \{(\asstate,\bsstate) \with \mforall{\zeta\in[0,r]}\holds\trajectory(\zeta)\in\imodel{\IddL}{\hevolve{\D{x}=\astrm(-\tau)}\land\ivr}$ and $\asstate=\trajectory(0)$ on $\scomplement{\{\D{x}\}}$ and $\bsstate=\trajectory(r)$ for a $\trajectory\from [0,r]\to\states\}$, i.e. there exists a $r\geq 0$ and a trajectory $\trajectory\from [0,r]\to\states$, which fulfills $\trajectory(\zeta)(\D{x})(s) \defeq \DD{\trajectory(t)(x)(s)}{t}(\zeta) \stackrel{!}{=} \ivaluation{\iconcat[state=\trajectory(\zeta+s)]{\IddL}}{\theta(-\tau)}$ and satisfies $\ivr$ for all $s\in[-\min\{\zeta,T\},0]$. On $[-T,-\min\{\zeta,T\})$ it holds $\trajectory(\zeta)(\cdot)(s)=\asstate(\cdot)(s+\zeta)$ for all variables.
            % TODO: case r=0
        \end{enumerate}
    \end{definition}

    semantics of DDE motivated by definition of solution of DDE
    $\trajectory$ solves the DDE and satisfies $\ivr$ in each time instant/state

    The formula $\hevolve{\D{x}=\astrm(-\tau)}\land\ivr$ has dropped the $\holdssince{T}{}$, alloccurences of $x$ and $\D{x}$ of form with constant

    % TODO: if $r=0$: 

    For the \emph{discrete assignment}, we only allow the values at the current time instant to be changed. A functional assignment would essentially allow to rewrite history, which is not permitted.

    This assignment is the actual reason why we need to consider piecewise continuous evolutions.

    %TODO: super dense time: multiple assignments, only consider last assignment

    Using this, in comparison to \dL extended syntax, we can write down both delay differential equations and ordinary differential equations in the form $\D{x}=\theta$, where $\theta=f(x,\xtau)$ with a polynomial $f$.

    % TODO: how to specify initial condition, for x and x', which need additionally coincide, have same partition
    % in general, we do not write expression explicitely, just give possible intervals in precondition
    
    As a \FOLR formula, $\ivr$ do not contain any delayed variables and thus only depend of the values at the current time instant (and not over the entire interval $\delayinterval$).

    \begin{definition}\label{def:termvars}
        We define by
        \begin{equation*}
            % FIXME: another symbol for defeq
            % TODO: what if x'[] in term ?
            \constants[\astrm] \defeq \set{c\in\constants \with \mexists{\xtau[c]\in\delayvars}\holds\xtau[c]\in\astrm}
        \end{equation*}
        the set of constant symbols occuring in the term $\astrm$.

        Note that this set does not contain $s$, since it is, as a special purpose symbol, not in $\constants$.
    \end{definition}

    % TODO: find better name for 'augmented trajectory'
    \begin{definition}[Augmented trajectory]\label{def:aug-trajectory}
        Since a term only depends on a finite number of atomic terms for a fixed s
        
        % TODO: what about x'
        The valuation of a concrete term can hence also be seen as a mapping from the values of $\delayvars$
        %and $\delaydiffvars$
        into $\R$, instead of using the functional state space as domain.

        This gives rise to the definition of the \emph{augmented trajectory} $\augtrajectory[s]{\astrm}\from\compactum{0}{r}\to\R^{\abs{\delayvars[\astrm]}}$ for a fixed $s\in\closeddelayinterval$ and term $\astrm$ with
        % FIXME: differnt vars possible, not just x
        \begin{equation*}
            \augtrajectory[s]{\astrm}(t) \defeq \colvec{\trajectory(t)(x_1)(c_1)\\ \vdots\\ \trajectory(t)(x_1)(c_n)\\ \vdots\\ \trajectory(t)(x_m)(c_1)\\ \vdots\\ \trajectory(t)(x_m)(c_n)}
        \end{equation*}
    \end{definition}
    % TODO: alternatively, could maybe have \trajectory Fréchet-diffable

    The following lemma shows the consistency of the semantics for differentials with the semantics of the evolution of a delay differential equation.
    This means that along a DDE, the values of differential symbols coincide with time derivative of the value of the corresponding variable.

    \begin{lemma}[Differential Lemma]\label{lm:differential-lemma}
        % FIXME: check if everywhere correctly used: \states=(\statespace)^n
        The value of a term $\bstrm$ along a trajectory $\trajectory\from\compactum{0}{r}\to\states$ satisfying a DDE for any duration $r>0$, i.e.
        % FIXME:doFormatList does not work with iconcat $\imodels{\iconcat[state=\trajectory]{\IddL}}{\D{x}=\asfml\land\ivr}$
        $\interpret,\trajectory\models(\D{x}=\asfml\land\ivr)$,
        % FIXME: do I need case s=0?
        is piecewise continuously differentiable and for all $\zeta\in\compactum{0}{r}$ and $s\in\closeddelayinterval$ it holds:
        % FIXME: equality holds also in jump points?
        \begin{equation*}
            \ivaluation{\iconcat[state=\trajectory(\zeta),assign=s]{\IddL}}{\D{(\bstrm)}} = \DD{\ivaluation{\iconcat[state=\trajectory(t),assign=s]{\IddL}}{\bstrm}}{t}(\zeta)
        \end{equation*}
        At discontinuity point stetige fortsetzung of/right hand side derivative.
        % FIXME: where do I need this satisfaction in proof, relation to DDE: semantics of DDE
    \end{lemma}
    \begin{proof}
        % TODO: what if x'[] in term ?
        % TODO: in init cond: x and x' need to match, ie d/ds x[s] = x'[s], same partition, specification of x' in init cond only needed when referenced to it later
        % FIXME: oBdA: t_0=0
        %Let $\trajectory\from\compactum{0}{r}$

        % FIXME: new statespace C^1_pw
        % FIXME: more possible variables, common partition is cup
        Let $\partition{-T=t_0}{t_m=0}$ be the partition of the initial condition $\trajectory(0)(x)\in\statespace$.
        %We show that value of a term is piecewise differentiable with partition $\mathcal{Z}$.
        % FIXME: c used for symbol and its interpretation
        Let in the following $s\in\compactum{-T}{0}$ be arbitray but fixed, such that $s$ can be treated as a constant, in the same way like any $c\in\constants$.
        Depending on the term $\bstrm$ and the fixed $s$, we define a partition $\mathcal{Z}_\bstrm^s=\partition{\hat{t}_0}{\hat{t}_k}$ of $\compactum{0}{r}$ by
        % FIXME: what when r>T ? Z={0,r}
        \begin{equation*}
            \mathcal{Z}_\bstrm^s \defeq \set{0,r}\cup \bigcup_{i=0}^m\bigcup_{\substack{c\in \mathcal{K}\\ t_i\geq c}}\set{t_i-c}\cup \bigcup_{i=0}^m\bigcup_{\substack{c\in \mathcal{K}\\ t_i\geq c}}\set{t_i+\tau-c}
        \end{equation*}
        where $\mathcal{K}\defeq\constants[\bstrm]\cup\constants[\astrm]\cup\set{s}$ is the set of constant symbols (or their interpretations/valuations) appeaering in the term $\bstrm$ and the right hand side of the DDE.
        The set $\mathcal{K}$ is finite and non-empty, since it contains at least the values $0$ and $r$.
        
        We show first that $\trajectory(t)(x)(c)$ is piecewise continuously differentiable in $t$ for all $c\in\mathcal{K}$ with partition $\mathcal{Z}_\bstrm^s$:

        Let $c\in\mathcal{K}$ and $\zeta\in(\hat{t}_j,\hat{t}_{j+1})$.
        Assume that $\zeta+c=t_i$ for some $i$. That is $\zeta=t_i-c=\hat{t}_k$ for some $k$. This is not possible by the choice of $\zeta$ lying between two consequtive $\hat{t}_j$.
        In the same way for $\zeta+c=t_i+\tau$.
        Hence for $\zeta\in(\hat{t}_j,\hat{t}_{j+1})$ it holds that $\zeta+c\neq t_i$ and $\zeta+c\neq t_i+\tau$ for all $c\in\mathcal{K}$ and for all $i\in\set{\range{0}{m}}$.

        We need to distinguish two cases.

        % FIXME: which cases includes =0 ?
        If $c+\zeta<0$, it holds by the definition of the DDE semantics that $\trajectory(\zeta)(x)(c)=\trajectory(0)(x)(c+\zeta)$, which is continuously differentiable as initial condition, if $\zeta+c\neq t_i$. Then
        \begin{equation*}
            \DD{\trajectory(t)(x)(c)}{t}(\zeta)=\DD{\trajectory(0)(x)(s)}{s}(c+\zeta)=\trajectory(0)(\D{x})(c+\zeta)=\trajectory(\zeta)(\D{x})(c)
        \end{equation*}
        For the limits it holds
        \begin{align*}
            \lim_{\zeta\downto\hat{t}_j} \DD{\trajectory(t)(x)(c)}{t}(\zeta)
                & = \lim_{\zeta\downto t_i-c} \DD{\trajectory(0)(x)(s)}{s}(c+\zeta)\\
                & = \lim_{\zeta\downto t_i} \DD{\trajectory(0)(x)(s)}{s}(\zeta)
                %=\lim_{s\downto t_i}\trajectory(0)(\D{x})(s)
                = \trajectory(0)(\D{x})(t_i)
        \end{align*}
        And analogously for the existence of the limit for $\zeta\upto\hat{t}_{j+1}$

        If $c+\zeta\geq 0$, then $\trajectory(\zeta)(x)(s)=\trajectory(\zeta+c)(x)(0)$ is differentiable in $\zeta$ with $\trajectory(\zeta)(\D{x})(s) = \DD{\trajectory(t)(x)(s)}{t}(\zeta)$ by the semantics of DDEs (Definition~\ref{def:semantic-HP}(\ref{itm:sem-HP-DDE})), if $\zeta+c\neq t_i+\tau$.
        % FIXME: jumppoints and pw conitnuity/diffable
        By Theorem~\ref{thm:solution-existence}: continuous and pw diffable with partition $Z$.

        % By definition, $\hat{t}_j=t_i-\hat{c}$ for some $i\in\set{\range{0}{m}}$ and $\hat{c}\in\mathcal{K}$.
        % If $c\geq\hat{c}$ then $\zeta>\hat{t}_j$ implies $c+\zeta > c+t_i-\hat{c}\geq t_i$.
        % If $c<\hat{c}$, then $\zeta < \hat{t}_{j+1} \leq t_i-c$ (needs explanation: tjp1 is smallest next point, construct one, must be greater or equal) and hence $\zeta+c<t_i$.
        % So whenever $\zeta\in(\hat{t}_j,\hat{t}_{j+1})$ is $c+\zeta\neq t_i$ for all $i=\range{0}{m}$ and $c\in\mathcal{K}$

        %On each $\zeta\in(\hat{t}_k,\hat{t}_{k+1})$ is each $\ivaluation{\iconcat[state={\trajectory(\zeta)},assign=s]{\IddL}}{\xtau[c]}$ diffable in $\zeta$

        %f in terms smooth, hence each term on this open interval diffable
        Let $\augtrajectory[s]{\astrm}$ be the $\bstrm$-augmented trajectory for the considered delay differential equation.
        By the transition semantics of DDEs (Definition~\ref{def:semantic-HP}\,(\ref{itm:sem-HP-DDE})), it holds for $\zeta+c\geq 0$ (along sol of DDE)
        $\trajectory(\zeta)(\D{x})(c) = \DD{\trajectory(t)(x)(c)}{t}(\zeta)$, and for $\zeta+c\leq 0$ (init cond, match demanded)

        \begin{align*}
            \DD{\ivaluation{\iconcat[state={\augtrajectory[s]{\bstrm}(\zeta)},assign=s]{\IddL}}{\bstrm}}{t}(\zeta)
            &= \D{\left(\ivaluation{\iconcat[state={}]{\IddL}}{\bstrm}\compose\augtrajectory[s]{\bstrm}(\zeta)\right)} = \gradient{\ivaluation{\iconcat[state={}]{\IddL}}{\bstrm}}(\augtrajectory[s]{\bstrm}(\zeta))\cdot\DD{\augtrajectory[s]{\bstrm}}{t}(\zeta)\\
            &= \sum_{\xtau[c]\in\delayvarswiths}\DD{\trajectory(t)(x)(c)}{t}(\zeta) \Dp[{(\xtau[c])}]{\ivaluation{\iconcat[state={\augtrajectory[s]{\bstrm}(\zeta)},assign=s]{\IddL}}{\bstrm}}\\
            % &= \sum_{\xtau[c]\in\delayvarswiths}\trajectory(\zeta)(\Dxtau[c])(s) \Dp[{(\xtau[c])}]{\ivaluation{\iconcat[state={\augtrajectory[s]{\bstrm}(\zeta)},assign=s]{\IddL}}{\bstrm}}{(s)}\\
            &= \sum_{\xtau[c]\in\delayvarswiths}\trajectory(\zeta)(\D{x})(c) \Dp[{(\xtau[c])}]{\ivaluation{\iconcat[state={\augtrajectory[s]{\bstrm}(\zeta)},assign=s]{\IddL}}{\bstrm}}\\
            %&= \sum_{\xtau[c]\in\delayvarswiths}\asstate(\D{x})(c) \Dp[{(\xtau[c])}]{\ivaluation{\IddL}{\bstrm}}{(s)}\\
            &= \ivaluation{\iconcat[state=\trajectory(\cdot),assign=s]{\IddL}}{\D{(\bstrm)}}(\zeta)
        \end{align*}
        % FIXME: limits
        where each sum only consits of finitely many summands.
    \end{proof}

    \begin{example}
        \begin{equation*}
            \D{\left(\holdssince{T}{x+\xtau[c]+\xtau[s]\geq 0}\right)} \equiv \holdssince{T}{\D{x}+\Dxtau[c]+\Dxtau[s]\geq 0}
        \end{equation*}
        where $c=-3.5$ and $s=-2$
        \begin{equation}
            \mathcal{Z}_\bstrm^s = \set{0,0.5,1,2.5,3.5,r}
        \end{equation}
        then $g_s\in\Cnpw[1]{\compactum{0}{r}}{\R}$ along traj de dde
        \begin{equation*}
            g_s(t)=\ivaluation{\iconcat[state=\trajectory(t),assign=s]{\IddL}}{\bstrm} = \ivaluation{\iconcat[state=\trajectory(t),assign=s]{\IddL}}{\xtau[0]} + \ivaluation{\iconcat[state=\trajectory(t),assign=s]{\IddL}}{\xtau[c]} + \ivaluation{\iconcat[state=\trajectory(t),assign=s]{\IddL}}{\xtau[s]}
        \end{equation*}
        each summand diffable in $(\hat{t}_j,\hat{t}_{j+1})$ and
        \begin{equation*}
            \D{g}_s(t)= \ivaluation{\iconcat[state=\trajectory(t),assign=s]{\IddL}}{\Dxtau[0]} + \ivaluation{\iconcat[state=\trajectory(t),assign=s]{\IddL}}{\Dxtau[c]} + \ivaluation{\iconcat[state=\trajectory(t),assign=s]{\IddL}}{\Dxtau[s]}
        \end{equation*}
        \begin{equation*}
            \lim_{\zeta\downto\hat{t}_j} \D{g}_s(\zeta)=
        \end{equation*}
    \end{example}

    \begin{lemma}[Differential assignment]\label{lm:diff-assignment}
        Let $\trajectory\from\compactum{0}{r}\to\states$ be a trajectory satisfying a DDE for any duration $r\geq 0$, i.e.
        $\interpret,\trajectory\models(\D{x}=\astrm\land\ivr)$.
        Then it holds:
        \begin{equation*}
            \interpret,\trajectory\models\asfml \lbisubjunct \trajectory(\zeta)\in\imodel{\IddL}{\dbox{\Dupdate{\Dumod{\D{x}}{\astrm}}}{\asfml}}  
        \end{equation*}
    \end{lemma}
    \begin{proof}
        Let $\zeta\in\compactum{0}{r}$. It is $\trajectory(\zeta)\in\imodel{\IddL}{\Dxtau[0]=\astrm}$ and $\trajectory(\zeta)\in\imodel{\IddL}{\ivr}$, which means $\trajectory(\zeta)(\D{x})(0)=\ivaluation{\iconcat[state=\trajectory(\zeta)]{\IddL}}{\astrm}$, since $\astrm$ is independent of $s$.
        By Definition~\ref{def:semantic-HP}(\ref{itm:sem-HP-assgn}) of the assignment's semantics, this implies $(\trajectory(\zeta),\bsstate)\in\ireachability{\IddL}{\Dupdate{\Dumod{\D{x}}{\astrm}}}$ if and only if $\bsstate=\trajectory(\zeta)$.
        Finally, this implies the equivalence
        \begin{align*}
            \trajectory(\zeta)\in\imodel{\IddL}{\asfml} &\lbisubjunct
            \mforall{\bsstate\in\states}\holds((\trajectory(\zeta),\bsstate)\in\ireachability{\IddL}{\Dupdate{\Dumod{\D{x}}{\astrm}}} \limply \bsstate\in\imodel{\IddL}{\asfml})\\
            &\lbisubjunct \trajectory(\zeta)\in\imodel{\IddL}{\dbox{\Dupdate{\Dumod{\D{x}}{\astrm}}}{\asfml}}
        \end{align*}
    \end{proof}

\section{Static Semantics}
    \label{sec:static-semantics}

    \subsection{History Horizon}
        \label{sec:history-horizon}

        \begin{definition}[History Horizon]
            The \emph{history horizon} is a function
            \begin{equation*}
                \HHfml\from \ddLformulas \to \R_{\leq 0}
            \end{equation*}
            which assigns to each \ddL formula the earliest point in time it references to. It limits the time interval of the state space $T\in$.
            The history horizon depends on all occurences of $\xtau[s]$ and $\xtau[c]$ in the formula.

            It is defined inductively for formulas by:
            \begin{enumerate}
                \item $\HHfml(\holdssince{T}{\astrm\geq\bstrm}) = \max\set{\HHtrm(\astrm),\HHtrm(\bstrm)}$
                \item $\HHfml(\holdssince{T}{p(\range{\istrm{1}}{\istrm{k}})}) = \max\set{\range{\HHtrm(\istrm{1})}{\HHtrm(\istrm{k})}}$
                \item $\HHfml(\contextapp{C}{\asfml}) = $
                \item $\HHfml(\lnot\asfml) = \HHfml(\asfml)$
                \item $\HHfml(\asfml\land\bsfml) = \max\set{\HHfml(\asfml),\HHfml(\bsfml)}$
                \item $\HHfml(\lforall{x}{\asfml}) = \HHfml(\asfml)$
                \item $\HHfml(\lexists{x}{\asfml}) = \HHfml(\asfml)$
                \item $\HHfml(\dbox{\asprg}{\asfml}) = \max\set{\HHprg(\asprg),\HHfml(\asfml)}$
                \item $\HHfml(\ddiamond{\asprg}{\asfml}) = \max\set{\HHprg(\asprg),\HHfml(\asfml)}$
            \end{enumerate}
            depending on terms
            \begin{enumerate}
                \item $\HHtrm(\xtau[s]) = 0$
                \item $\HHtrm(\Dxtau[s]) = 0$
                \item $\HHtrm(\xtau[c]) = \abs{c}$
                \item $\HHtrm(\Dxtau[c]) = \abs{c}$
                \item $\HHtrm(c) = 0$
                \item $\HHtrm(f(\range{\istrm{1}}{\istrm{k}})) = \max\set{\range{\HHtrm(\istrm{1})}{\HHtrm(\istrm{k})}}$
                \item $\HHtrm(\astrm + \bstrm) = \max\set{\HHtrm(\astrm),\HHtrm(\bstrm)}$
                \item $\HHtrm(\astrm \cdot \bstrm) = \max\set{\HHtrm(\astrm),\HHtrm(\bstrm)}$
            \end{enumerate}
            and \HPs
            \begin{enumerate}
                \item $\HHprg(a) = 0$
                \item $\HHprg(\hupdate{\humod{x}{\astrm}}) = 0$
                \item $\HHprg(\Dupdate{\Dumod{\D{x}}{\astrm}}) = 0$
                \item $\HHprg(\htest{\asfmlfolR}) = 0$
                \item $\HHprg(\hchoice{\asprg}{\bsprg}) = \max\set{\HHprg(\asprg),\HHprg(\bsprg)}$
                % TODO: replace ; in HPs
                \item $\HHprg(\asprg;\bsprg) = \max\set{\HHprg(\asprg),\HHprg(\bsprg)}$
                \item $\HHprg(\hrepeat{\asprg}) = \HHprg(\asprg)$
                \item $\HHprg(\hevolvein{\D{x}=\astrm(-\tau)}{\ivr}) = \HHtrm(\astrm(-\tau))$
            \end{enumerate}
            For formulae as
            
            T in forall: comp, pred
            minimum of T in forall parts of subformulas: quantifier, not and
            forall, exists?
            modalities: max $\tau$ in DDE and of formula
        \end{definition}
        %We need to use $\min$, since $\HH$ is a non-positive number. It is the biggest in absolute value.
    
    \subsection{Variable Binding}
        \label{sec:variable-binding}

        \begin{definition}[Free variable]
            for terms: $\freevars{\astrm}\subseteq\allvars\cup\diffvars\cup\set{s}$, variables that occur in term
            \begin{align*}
                \freevars{\xtau[s]} &= \set{x,s}\\
                \freevars{\Dxtau[s]} &= \set{\D{x},s}\\
                \freevars{\xtau[b]} &= \set{x}\\
                \freevars{\Dxtau[b]} &= \set{\D{x}}\\
                \freevars{c} &= \emptyset\\
                \freevars{f(\range{\istrm{1}}{\istrm{k}})} &= \freevars{\istrm{1}} \cup\cdots\cup \freevars{\istrm{k}}\\
                \freevars{\astrm + \bstrm} = \freevars{\astrm \cdot \bstrm} &= \freevars{\astrm}\cup\freevars{\bstrm}\\
                \freevars{\D{(\astrm)}} &= \freevars{\astrm}\cup\D{\freevars{\astrm}}
            \end{align*}
                
        \end{definition}    

    \subsection{Well-defined Formulae}
        \label{sec:well-definedness}
    
        $s$ must not be free
        and

        \begin{definition}[Well-defined formula]
            obeys syntactic definition
            premisse defines element od statespace for all occuring variables and diffs
        \end{definition}

        \begin{example}
            \begin{equation*}
                % FIXME: notation/syntax: ausgeklammertes forall in formulas
                \dbox{\hupdate{\humod{x}{\xtau[-3]^2}};\hevolvein{\D{x}=\xtau+2x}{(x\geq 0)}}{\holdssinceclosed{T}{0\leq \xtau[s] \land \xtau[s]\leq\xtau[-5]}}
            \end{equation*}
            Hence the history horizon needs to be set to
            \begin{equation*}
                T=\max\set{\max\set{3,\tau},\max\set{0,5}}.
            \end{equation*}
        \end{example}

        % TODO: feasible history horizon for a HP
        \begin{lemma}
            choosing the statespace according to history horizon of HP determines
        \end{lemma}

        \begin{example}
            
        \end{example}
